<!doctype html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Bar & Cafe Menu</title>
    <meta
      name="description"
      content="Menu bar & cafe dengan keranjang, checkout, pembayaran cash/transfer, dan struk."
    />
    <style>
      :root {
        --bg: #0b0f1a;
        --panel: #0f172a;
        --panel2: #111c3a;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --brand: #22c55e;
        --brand2: #60a5fa;
        --danger: #ef4444;
        --warn: #f59e0b;
        --ring: rgba(96, 165, 250, 0.35);
        --shadow: 0 20px 60px rgba(0, 0, 0, 0.55);
        --radius: 18px;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
      }
      body {
        margin: 0;
        font-family:
          ui-sans-serif,
          system-ui,
          -apple-system,
          Segoe UI,
          Roboto,
          Helvetica,
          Arial;
        color: var(--text);
        background:
          radial-gradient(
            1200px 600px at 15% 10%,
            rgba(96, 165, 250, 0.18),
            transparent 55%
          ),
          radial-gradient(
            900px 500px at 85% 0%,
            rgba(34, 197, 94, 0.18),
            transparent 55%
          ),
          radial-gradient(
            800px 500px at 50% 90%,
            rgba(245, 158, 11, 0.12),
            transparent 55%
          ),
          linear-gradient(180deg, #070a12, #0b1226 55%, #070a12);
        overflow-x: hidden;
      }

      /* Layout */
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 24px;
      }
      header {
        position: sticky;
        top: 0;
        z-index: 20;
        backdrop-filter: blur(10px);
        background: linear-gradient(
          180deg,
          rgba(11, 15, 26, 0.88),
          rgba(11, 15, 26, 0.62)
        );
        border-bottom: 1px solid rgba(148, 163, 184, 0.12);
      }
      .topbar {
        display: flex;
        align-items: center;
        gap: 14px;
        padding: 16px 24px;
        max-width: 1200px;
        margin: 0 auto;
      }
      .logo {
        width: 46px;
        height: 46px;
        border-radius: 14px;
        background: radial-gradient(
          circle at 30% 30%,
          rgba(96, 165, 250, 0.9),
          rgba(34, 197, 94, 0.55) 55%,
          rgba(15, 23, 42, 1) 100%
        );
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.45);
        flex: 0 0 auto;
      }
      .brand {
        display: flex;
        flex-direction: column;
        line-height: 1.1;
      }
      .brand b {
        font-size: 16px;
        letter-spacing: 0.2px;
      }
      .brand small {
        color: var(--muted);
        font-size: 12px;
      }

      .searchWrap {
        flex: 1;
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .search {
        flex: 1;
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 14px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.72);
        border: 1px solid rgba(148, 163, 184, 0.14);
        box-shadow: 0 0 0 0 rgba(0, 0, 0, 0);
        transition: 0.2s;
      }
      .search:focus-within {
        border-color: rgba(96, 165, 250, 0.45);
        box-shadow: 0 0 0 5px var(--ring);
      }
      .search input {
        width: 100%;
        border: none;
        outline: none;
        background: transparent;
        color: var(--text);
        font-size: 14px;
      }
      .chip {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 999px;
        background: rgba(15, 23, 42, 0.72);
        border: 1px solid rgba(148, 163, 184, 0.14);
        color: var(--text);
        cursor: pointer;
        user-select: none;
        transition: 0.2s;
        font-size: 13px;
      }
      .chip:hover {
        transform: translateY(-1px);
        border-color: rgba(96, 165, 250, 0.35);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        min-width: 22px;
        height: 22px;
        padding: 0 7px;
        border-radius: 999px;
        background: rgba(34, 197, 94, 0.18);
        border: 1px solid rgba(34, 197, 94, 0.45);
        color: #bbf7d0;
        font-weight: 700;
        font-size: 12px;
      }

      /* Page grid */
      .grid {
        display: grid;
        grid-template-columns: 1.35fr 0.65fr;
        gap: 18px;
        align-items: start;
        margin-top: 18px;
      }
      @media (max-width: 980px) {
        .grid {
          grid-template-columns: 1fr;
        }
      }

      /* Category tabs */
      .tabs {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        padding: 14px;
        border-radius: var(--radius);
        background: rgba(15, 23, 42, 0.62);
        border: 1px solid rgba(148, 163, 184, 0.12);
        box-shadow: var(--shadow);
      }
      .tab {
        padding: 10px 12px;
        border-radius: 999px;
        cursor: pointer;
        user-select: none;
        background: rgba(17, 28, 58, 0.55);
        border: 1px solid rgba(148, 163, 184, 0.12);
        color: var(--muted);
        transition: 0.2s;
        font-size: 13px;
      }
      .tab.active {
        color: var(--text);
        border-color: rgba(96, 165, 250, 0.5);
        box-shadow: 0 0 0 4px rgba(96, 165, 250, 0.12);
      }
      .tab:hover {
        transform: translateY(-1px);
        color: var(--text);
      }

      /* Menu cards */
      .menuPanel {
        margin-top: 14px;
        padding: 14px;
        border-radius: var(--radius);
        background: rgba(15, 23, 42, 0.62);
        border: 1px solid rgba(148, 163, 184, 0.12);
        box-shadow: var(--shadow);
      }
      .menuHeader {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 14px;
        margin-bottom: 12px;
      }
      .menuHeader h1 {
        font-size: 18px;
        margin: 0;
        letter-spacing: 0.2px;
      }
      .menuHeader p {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
      }

      .cards {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
      }
      @media (max-width: 980px) {
        .cards {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 560px) {
        .cards {
          grid-template-columns: 1fr;
        }
      }

      .card {
        background: linear-gradient(
          180deg,
          rgba(17, 28, 58, 0.65),
          rgba(15, 23, 42, 0.65)
        );
        border: 1px solid rgba(148, 163, 184, 0.12);
        border-radius: 20px;
        padding: 14px;
        position: relative;
        overflow: hidden;
        transition: 0.2s;
        min-height: 164px;
      }
      .card:before {
        content: "";
        position: absolute;
        inset: -40px -40px auto auto;
        width: 160px;
        height: 160px;
        background: radial-gradient(
          circle at 30% 30%,
          rgba(96, 165, 250, 0.35),
          transparent 60%
        );
        transform: rotate(25deg);
        pointer-events: none;
      }
      .card:hover {
        transform: translateY(-2px);
        border-color: rgba(96, 165, 250, 0.3);
      }

      .cardTop {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 10px;
      }
      .pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 10px;
        border-radius: 999px;
        background: rgba(34, 197, 94, 0.12);
        border: 1px solid rgba(34, 197, 94, 0.3);
        color: #bbf7d0;
        font-size: 12px;
        font-weight: 700;
        white-space: nowrap;
      }
      .pill.low {
        background: rgba(245, 158, 11, 0.12);
        border-color: rgba(245, 158, 11, 0.35);
        color: #fde68a;
      }
      .pill.out {
        background: rgba(239, 68, 68, 0.12);
        border-color: rgba(239, 68, 68, 0.35);
        color: #fecaca;
      }

      .title {
        margin: 10px 0 6px;
        font-weight: 800;
        letter-spacing: 0.2px;
      }
      .desc {
        margin: 0;
        color: var(--muted);
        font-size: 13px;
        line-height: 1.35;
        min-height: 34px;
      }

      .cardBottom {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 12px;
        gap: 10px;
      }
      .price {
        font-weight: 900;
        font-size: 15px;
      }
      .btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 12px;
        border-radius: 14px;
        background: linear-gradient(
          180deg,
          rgba(34, 197, 94, 0.95),
          rgba(34, 197, 94, 0.75)
        );
        border: 1px solid rgba(34, 197, 94, 0.35);
        color: #052e16;
        font-weight: 900;
        cursor: pointer;
        transition: 0.2s;
        box-shadow: 0 12px 30px rgba(34, 197, 94, 0.18);
        white-space: nowrap;
      }
      .btn:hover {
        transform: translateY(-1px);
      }
      .btn:active {
        transform: translateY(0px);
      }
      .btn.secondary {
        background: rgba(17, 28, 58, 0.65);
        border-color: rgba(148, 163, 184, 0.16);
        color: var(--text);
        box-shadow: none;
      }
      .btn.danger {
        background: rgba(239, 68, 68, 0.14);
        border-color: rgba(239, 68, 68, 0.4);
        color: #fecaca;
        box-shadow: none;
      }
      .btn:disabled {
        opacity: 0.45;
        cursor: not-allowed;
        transform: none;
      }

      /* Cart */
      .cart {
        position: sticky;
        top: 92px;
        padding: 14px;
        border-radius: var(--radius);
        background: rgba(15, 23, 42, 0.62);
        border: 1px solid rgba(148, 163, 184, 0.12);
        box-shadow: var(--shadow);
      }
      .cartHead {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
      }
      .cartHead h2 {
        margin: 0;
        font-size: 16px;
      }
      .cartHead small {
        color: var(--muted);
      }

      .cartList {
        margin-top: 12px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .line {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        padding: 10px;
        border-radius: 16px;
        background: rgba(17, 28, 58, 0.55);
        border: 1px solid rgba(148, 163, 184, 0.12);
      }
      .line b {
        font-size: 13px;
      }
      .line span {
        color: var(--muted);
        font-size: 12px;
      }
      .qty {
        display: flex;
        gap: 8px;
        align-items: center;
        justify-content: flex-end;
      }
      .qty button {
        width: 30px;
        height: 30px;
        border-radius: 12px;
        cursor: pointer;
        border: 1px solid rgba(148, 163, 184, 0.16);
        background: rgba(15, 23, 42, 0.55);
        color: var(--text);
        font-weight: 900;
        transition: 0.2s;
      }
      .qty button:hover {
        transform: translateY(-1px);
        border-color: rgba(96, 165, 250, 0.35);
      }
      .qty input {
        width: 42px;
        text-align: center;
        border: none;
        outline: none;
        border-radius: 12px;
        padding: 6px 8px;
        background: rgba(11, 15, 26, 0.6);
        color: var(--text);
        border: 1px solid rgba(148, 163, 184, 0.12);
      }

      .summary {
        margin-top: 12px;
        padding-top: 12px;
        border-top: 1px dashed rgba(148, 163, 184, 0.22);
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        font-size: 13px;
        color: var(--muted);
      }
      .row b {
        color: var(--text);
      }

      .cta {
        display: flex;
        gap: 10px;
        margin-top: 12px;
      }
      .cta .btn {
        flex: 1;
        justify-content: center;
      }

      /* Modal */
      .overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.55);
        backdrop-filter: blur(4px);
        display: none;
        align-items: center;
        justify-content: center;
        padding: 18px;
        z-index: 50;
      }
      .overlay.show {
        display: flex;
      }
      .modal {
        width: min(740px, 100%);
        border-radius: 22px;
        background: linear-gradient(
          180deg,
          rgba(17, 28, 58, 0.95),
          rgba(15, 23, 42, 0.95)
        );
        border: 1px solid rgba(148, 163, 184, 0.16);
        box-shadow: var(--shadow);
        overflow: hidden;
      }
      .modalHead {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        border-bottom: 1px solid rgba(148, 163, 184, 0.14);
      }
      .modalHead h3 {
        margin: 0;
        font-size: 16px;
      }
      .modalBody {
        padding: 16px;
        display: grid;
        grid-template-columns: 1.05fr 0.95fr;
        gap: 14px;
      }
      @media (max-width: 860px) {
        .modalBody {
          grid-template-columns: 1fr;
        }
      }

      .panel {
        padding: 14px;
        border-radius: 18px;
        background: rgba(15, 23, 42, 0.6);
        border: 1px solid rgba(148, 163, 184, 0.12);
      }
      .panel h4 {
        margin: 0 0 10px;
        font-size: 14px;
      }
      .field {
        display: flex;
        flex-direction: column;
        gap: 6px;
        margin: 10px 0;
      }
      label {
        font-size: 12px;
        color: var(--muted);
      }
      input,
      textarea,
      select {
        border-radius: 14px;
        border: 1px solid rgba(148, 163, 184, 0.16);
        background: rgba(11, 15, 26, 0.55);
        color: var(--text);
        padding: 10px 12px;
        outline: none;
        font-size: 13px;
      }
      textarea {
        min-height: 86px;
        resize: vertical;
      }
      input:focus,
      textarea:focus,
      select:focus {
        border-color: rgba(96, 165, 250, 0.45);
        box-shadow: 0 0 0 5px var(--ring);
      }

      .payMethods {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .radio {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        border-radius: 16px;
        border: 1px solid rgba(148, 163, 184, 0.14);
        background: rgba(17, 28, 58, 0.55);
        cursor: pointer;
        user-select: none;
        transition: 0.2s;
        flex: 1;
        min-width: 180px;
      }
      .radio:hover {
        transform: translateY(-1px);
        border-color: rgba(96, 165, 250, 0.3);
      }
      .radio input {
        accent-color: #60a5fa;
        width: 16px;
        height: 16px;
      }

      .note {
        font-size: 12px;
        color: var(--muted);
        line-height: 1.35;
      }
      .toast {
        position: fixed;
        left: 50%;
        transform: translateX(-50%);
        bottom: 18px;
        z-index: 60;
        padding: 12px 14px;
        border-radius: 16px;
        background: rgba(15, 23, 42, 0.92);
        border: 1px solid rgba(148, 163, 184, 0.14);
        box-shadow: var(--shadow);
        display: none;
        max-width: min(520px, calc(100% - 24px));
        font-size: 13px;
      }
      .toast.show {
        display: block;
        animation: pop 0.18s ease-out;
      }
      @keyframes pop {
        from {
          transform: translateX(-50%) translateY(10px);
          opacity: 0.4;
        }
        to {
          transform: translateX(-50%) translateY(0);
          opacity: 1;
        }
      }

      .footerNote {
        margin-top: 12px;
        color: var(--muted);
        font-size: 12px;
      }

      .kbd {
        font-family:
          ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
          "Liberation Mono", monospace;
        padding: 2px 6px;
        border-radius: 8px;
        border: 1px solid rgba(148, 163, 184, 0.16);
        background: rgba(11, 15, 26, 0.55);
        color: var(--text);
      }

      /* Print */
      @media print {
        header,
        .tabs,
        .menuPanel,
        .cart,
        .toast {
          display: none !important;
        }
        body {
          background: white;
          color: black;
        }
        .overlay {
          display: block;
          position: static;
          background: transparent;
          backdrop-filter: none;
          padding: 0;
        }
        .modal {
          box-shadow: none;
          border: none;
        }
        .modalHead button {
          display: none;
        }
        .panel {
          border: 1px solid #ddd;
          background: white;
        }
      }
    </style>
  </head>
  <body>
    <header>
      <div class="topbar">
        <div class="logo" aria-hidden="true"></div>
        <div class="brand">
          <b> CAFE Alcohol</b>
          <small>Menu • Keranjang • Checkout</small>
        </div>

        <div class="searchWrap">
          <div class="search" role="search">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              aria-hidden="true"
            >
              <path
                d="M21 21l-4.3-4.3m1.3-5.2a7.5 7.5 0 11-15 0 7.5 7.5 0 0115 0z"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
            <input
              id="q"
              placeholder="Cari menu… (contoh: mojito, pizza, espresso)"
              autocomplete="off"
            />
            <span class="kbd">Ctrl</span><span class="kbd">K</span>
          </div>
          <div class="chip" id="btnHistory" title="Lihat pesanan terakhir">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              aria-hidden="true"
            >
              <path
                d="M3 12a9 9 0 101-4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <path
                d="M3 5v4h4"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <path
                d="M12 7v6l4 2"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
            Riwayat
          </div>
          <div class="chip" id="btnOpenCheckout">
            <svg
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              aria-hidden="true"
            >
              <path
                d="M6 7h15l-1.5 8.5a3 3 0 01-3 2.5H9a3 3 0 01-3-2.5L5 3H2"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
              <path
                d="M10 22a1 1 0 100-2 1 1 0 000 2zm8 0a1 1 0 100-2 1 1 0 000 2z"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
              />
            </svg>
            Keranjang <span class="badge" id="cartCount">0</span>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="tabs" id="tabs"></div>

      <div class="grid">
        <section>
          <div class="menuPanel">
            <div class="menuHeader">
              <div>
                <h1 id="panelTitle">Menu Pilihan</h1>
                <p id="panelSub">
                  Pilih kategori, tambahkan ke keranjang, lalu checkout.
                </p>
              </div>
              <button
                class="btn secondary"
                id="btnSurprise"
                title="Acak rekomendasi"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 24 24"
                  fill="none"
                  aria-hidden="true"
                >
                  <path
                    d="M16 3h5v5"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M4 20l7-7"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M21 3l-8 8"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M21 16v5h-5"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M4 4l7 7"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M21 21l-8-8"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                </svg>
                Surprise
              </button>
            </div>
            <div class="cards" id="cards"></div>
            <div class="footerNote">
              Tips: klik <span class="kbd">Ctrl</span> +
              <span class="kbd">K</span> untuk fokus ke pencarian.
            </div>
          </div>
        </section>

        <aside class="cart" aria-label="Keranjang">
          <div class="cartHead">
            <div>
              <h2>Keranjang</h2>
              <small id="cartHint">Belum ada item.</small>
            </div>
            <button
              class="btn danger"
              id="btnClear"
              title="Kosongkan keranjang"
            >
              Reset
            </button>
          </div>

          <div class="cartList" id="cartList"></div>

          <div class="summary">
            <div class="row">
              <span>Subtotal</span><b id="subTotal">Rp 0</b>
            </div>
            <div class="row">
              <span>Pajak & Service (10%)</span><b id="tax">Rp 0</b>
            </div>
            <div class="row"><span>Total</span><b id="grand">Rp 0</b></div>

            <div class="cta">
              <button class="btn secondary" id="btnSave">Simpan Draft</button>
              <button class="btn" id="btnCheckout" disabled>Checkout</button>
            </div>
          </div>
        </aside>
      </div>
    </main>

    <!-- Checkout / History Modal -->
    <div class="overlay" id="overlay" aria-hidden="true">
      <div
        class="modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modalTitle"
      >
        <div class="modalHead">
          <h3 id="modalTitle">Checkout</h3>
          <button class="btn secondary" id="btnClose">Tutup</button>
        </div>
        <div class="modalBody">
          <div class="panel" id="leftPanel">
            <h4>Rincian Pesanan</h4>
            <div id="orderLines"></div>
            <div
              style="
                margin-top: 12px;
                padding-top: 12px;
                border-top: 1px dashed rgba(148, 163, 184, 0.22);
              "
            >
              <div class="row"><span>Subtotal</span><b id="mSub">Rp 0</b></div>
              <div class="row">
                <span>Pajak & Service (10%)</span><b id="mTax">Rp 0</b>
              </div>
              <div class="row"><span>Total</span><b id="mGrand">Rp 0</b></div>
            </div>

            <div class="field">
              <label for="notes">Catatan (opsional)</label>
              <textarea
                id="notes"
                placeholder="Contoh: tanpa es, level pedas 2, dll."
              ></textarea>
            </div>

            <div class="note">
              *Disclaimer: Hanya untuk pengguna usia legal sesuai hukum
              setempat. Minum alkohol secara bertanggung jawab.
            </div>
          </div>

          <div class="panel" id="rightPanel">
            <h4>Pembayaran</h4>

            <div class="field">
              <label for="customer">Nama Pelanggan</label>
              <input id="customer" placeholder="Nama" />
            </div>

            <div class="field">
              <label for="table">No. Meja / Takeaway</label>
              <input id="table" placeholder="Contoh: Meja 7 / Takeaway" />
            </div>

            <div class="field">
              <label>Metode</label>
              <div class="payMethods">
                <label class="radio"
                  ><input type="radio" name="pay" value="cash" checked />
                  Cash</label
                >
                <label class="radio"
                  ><input type="radio" name="pay" value="transfer" />
                  Transfer</label
                >
              </div>
            </div>

            <div id="cashBox">
              <div class="field">
                <label for="paid">Uang Dibayar (Cash)</label>
                <input
                  id="paid"
                  inputmode="numeric"
                  placeholder="Contoh: 100000"
                />
              </div>
              <div class="row">
                <span>Kembalian</span><b id="change">Rp 0</b>
              </div>
              <div class="note" style="margin-top: 8px">
                Kembalian otomatis dihitung. Jika kurang, tombol Bayar akan
                terkunci.
              </div>
            </div>

            <div id="tfBox" style="display: none">
              <div class="panel" style="margin-top: 10px">
                <h4 style="margin: 0 0 8px">Instruksi Transfer</h4>
                <div class="note">
                  Bank: <b>BCA</b><br />
                  No. Rek: <b>1234567890</b><br />
                  A/N: <b>Alchemy Bar & Cafe</b><br />
                  Catatan: tulis <b>Nama + No.Meja</b>
                </div>
              </div>
              <div class="field" style="margin-top: 10px">
                <label for="tfRef"
                  >Kode Referensi / ID Transaksi (opsional)</label
                >
                <input id="tfRef" placeholder="Contoh: TRX-982311" />
              </div>
              <div class="note">
                Setelah transfer, klik Bayar untuk membuat struk. (Untuk
                produksi, biasanya verifikasi otomatis/manual diperlukan.)
              </div>
            </div>

            <div class="cta" style="margin-top: 14px">
              <button class="btn secondary" id="btnPrint" title="Cetak struk">
                Cetak
              </button>
              <button class="btn" id="btnPay">Bayar & Buat Struk</button>
            </div>

            <div class="footerNote" id="payStatus"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
      // ====== Data (edit sesuai kebutuhan) ======
      const MENU = [
        // Cocktails
        {
          id: "ck1",
          cat: "Cocktails",
          name: "Classic Mojito",
          price: 68000,
          stock: 18,
          badge: "Fresh Mint",
          desc: "Rum, mint, lime, soda. Segar & ringan.",
        },
        {
          id: "ck2",
          cat: "Cocktails",
          name: "Negroni",
          price: 79000,
          stock: 10,
          badge: "Bold",
          desc: "Gin, Campari, vermouth. Bitter-sweet elegan.",
        },
        {
          id: "ck3",
          cat: "Cocktails",
          name: "Espresso Martini",
          price: 82000,
          stock: 7,
          badge: "Caffeine",
          desc: "Vodka, espresso, coffee liqueur. Creamy.",
        },
        {
          id: "ck4",
          cat: "Cocktails",
          name: "Whiskey Sour",
          price: 76000,
          stock: 12,
          badge: "Classic",
          desc: "Whiskey, lemon, simple syrup. Silky foam.",
        },
        {
          id: "ck5",
          cat: "Cocktails",
          name: "Aperol Spritz",
          price: 72000,
          stock: 9,
          badge: "Sparkling",
          desc: "Aperol, prosecco, soda. Citrus & bubbly.",
        },
        {
          id: "ck6",
          cat: "Cocktails",
          name: "Lychee Rose Fizz",
          price: 74000,
          stock: 5,
          badge: "Signature",
          desc: "Gin, lychee, rose, soda. Floral, wangi.",
        },

        // Beer
        {
          id: "br1",
          cat: "Beer",
          name: "Craft IPA Pint",
          price: 65000,
          stock: 14,
          badge: "Hoppy",
          desc: "Aroma citrus, bitterness seimbang.",
        },
        {
          id: "br2",
          cat: "Beer",
          name: "Wheat Beer Pint",
          price: 62000,
          stock: 11,
          badge: "Smooth",
          desc: "Rasa lembut, hint banana & clove.",
        },
        {
          id: "br3",
          cat: "Beer",
          name: "Stout Pint",
          price: 67000,
          stock: 6,
          badge: "Roasty",
          desc: "Cokelat gelap, roasted malt.",
        },

        // Wine
        {
          id: "wn1",
          cat: "Wine",
          name: "Red Wine (Glass)",
          price: 88000,
          stock: 20,
          badge: "Dry",
          desc: "Medium body, notes berry & oak.",
        },
        {
          id: "wn2",
          cat: "Wine",
          name: "White Wine (Glass)",
          price: 86000,
          stock: 16,
          badge: "Crisp",
          desc: "Citrus, apple, clean finish.",
        },
        {
          id: "wn3",
          cat: "Wine",
          name: "Sparkling (Glass)",
          price: 94000,
          stock: 8,
          badge: "Bubbly",
          desc: "Bright acidity, celebratory.",
        },

        // Spirits
        {
          id: "sp1",
          cat: "Spirits",
          name: "Whiskey (Single)",
          price: 90000,
          stock: 15,
          badge: "Aged",
          desc: "Single pour, pilihan bartender.",
        },
        {
          id: "sp2",
          cat: "Spirits",
          name: "Gin (Single)",
          price: 85000,
          stock: 12,
          badge: "Botanical",
          desc: "Aroma juniper, clean.",
        },
        {
          id: "sp3",
          cat: "Spirits",
          name: "Rum (Single)",
          price: 82000,
          stock: 10,
          badge: "Caramel",
          desc: "Notes vanilla & caramel.",
        },

        // Coffee & Non-Alcohol
        {
          id: "cf1",
          cat: "Coffee & Mocktails",
          name: "Iced Latte",
          price: 42000,
          stock: 40,
          badge: "Coffee",
          desc: "Espresso + susu, over ice.",
        },
        {
          id: "cf2",
          cat: "Coffee & Mocktails",
          name: "Cold Brew",
          price: 45000,
          stock: 28,
          badge: "Smooth",
          desc: "Low acid, clean finish.",
        },
        {
          id: "cf3",
          cat: "Coffee & Mocktails",
          name: "Virgin Mojito",
          price: 52000,
          stock: 22,
          badge: "Zero Proof",
          desc: "Mint, lime, soda. No alcohol.",
        },
        {
          id: "cf4",
          cat: "Coffee & Mocktails",
          name: "Berry Kombucha",
          price: 56000,
          stock: 12,
          badge: "Spark",
          desc: "Fermented tea, berry notes.",
        },

        // Food
        {
          id: "fd1",
          cat: "Food",
          name: "Truffle Fries",
          price: 56000,
          stock: 30,
          badge: "Best Seller",
          desc: "Kentang renyah + truffle mayo.",
        },
        {
          id: "fd2",
          cat: "Food",
          name: "Chicken Wings",
          price: 68000,
          stock: 18,
          badge: "Spicy",
          desc: "Saus pilihan: BBQ / Buffalo / Honey.",
        },
        {
          id: "fd3",
          cat: "Food",
          name: "Margherita Pizza",
          price: 98000,
          stock: 12,
          badge: "Classic",
          desc: "Tomato, mozzarella, basil.",
        },
        {
          id: "fd4",
          cat: "Food",
          name: "Cheese Platter",
          price: 120000,
          stock: 8,
          badge: "Pairing",
          desc: "Keju, buah, crackers. Cocok wine.",
        },
      ];

      const TAX_RATE = 0.1; // 10% pajak & service

      // ====== Helpers ======
      const rupiah = (n) =>
        new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
          maximumFractionDigits: 0,
        }).format(n || 0);
      const el = (id) => document.getElementById(id);
      const toast = (msg) => {
        const t = el("toast");
        if (!t) return;
        t.textContent = msg;
        t.classList.add("show");
        clearTimeout(toast._t);
        toast._t = setTimeout(() => t.classList.remove("show"), 2400);
      };
      const clampInt = (v, min, max) => {
        const n = Math.floor(Number(v));
        if (!Number.isFinite(n)) return min;
        return Math.max(min, Math.min(max, n));
      };

      // ====== State ======
      const state = {
        category: "All",
        query: "",
        cart: new Map(), // id -> qty
        draftKey: "alchemy_cart_draft_v1",
        historyKey: "alchemy_orders_history_v1",
      };

      // ====== UI Setup ======
      const categories = [
        "All",
        ...Array.from(new Set(MENU.map((m) => m.cat))),
      ];

      function renderTabs() {
        const wrap = el("tabs");
        if (!wrap) return;
        wrap.innerHTML = "";
        categories.forEach((cat) => {
          const b = document.createElement("div");
          b.className = "tab" + (state.category === cat ? " active" : "");
          b.textContent = cat;
          b.onclick = () => {
            state.category = cat;
            renderAll();
          };
          wrap.appendChild(b);
        });
      }

      function stockPill(stock) {
        if (stock <= 0) return '<span class="pill out">Habis</span>';
        if (stock <= 6)
          return '<span class="pill low">Sisa ' + stock + "</span>";
        return '<span class="pill">Ready</span>';
      }

      function matches(item) {
        if (state.category !== "All" && item.cat !== state.category)
          return false;
        const q = state.query.trim().toLowerCase();
        if (!q) return true;
        const hay = (
          item.name +
          " " +
          item.desc +
          " " +
          item.cat +
          " " +
          (item.badge || "")
        ).toLowerCase();
        return hay.includes(q);
      }

      function renderCards() {
        const list = MENU.filter(matches);
        const cards = el("cards");
        if (!cards) return;
        cards.innerHTML = "";

        if (!list.length) {
          cards.innerHTML = `<div class="card" style="grid-column:1/-1; min-height:110px; display:flex; align-items:center; justify-content:space-between; gap:12px">
          <div>
            <div class="title">Tidak ditemukan</div>
            <p class="desc">Coba kata kunci lain, atau ganti kategori.</p>
          </div>
          <button class="btn secondary" id="btnClearSearch">Reset Pencarian</button>
        </div>`;
          setTimeout(() => {
            const btn = el("btnClearSearch");
            if (btn)
              btn.onclick = () => {
                const q = el("q");
                if (q) q.value = "";
                state.query = "";
                renderAll();
              };
          }, 0);
          return;
        }

        list.forEach((item) => {
          const inCart = state.cart.get(item.id) || 0;
          const disabled = item.stock <= 0;
          const card = document.createElement("div");
          card.className = "card";
          card.innerHTML = `
          <div class="cardTop">
            <div class="pill" style="background: rgba(96,165,250,.12); border-color: rgba(96,165,250,.35); color:#bfdbfe">${item.cat}</div>
            ${stockPill(item.stock)}
          </div>
          <div class="title">${item.name}</div>
          <p class="desc">${item.desc}</p>
          <div class="cardBottom">
            <div>
              <div class="price">${rupiah(item.price)}</div>
              <div style="color:var(--muted); font-size:12px; margin-top:2px">${item.badge ? "• " + item.badge : ""}</div>
            </div>
            <button class="btn" ${disabled ? "disabled" : ""} data-add="${item.id}">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
              ${inCart ? "Tambah (x" + inCart + ")" : "Tambah"}
            </button>
          </div>
        `;
          cards.appendChild(card);
        });

        cards.querySelectorAll("[data-add]").forEach((btn) => {
          btn.addEventListener("click", () =>
            addToCart(btn.getAttribute("data-add")),
          );
        });
      }

      function cartItems() {
        const items = [];
        for (const [id, qty] of state.cart.entries()) {
          const item = MENU.find((m) => m.id === id);
          if (!item) continue;
          items.push({ ...item, qty });
        }
        return items;
      }

      function totals() {
        const items = cartItems();
        const sub = items.reduce((a, it) => a + it.price * it.qty, 0);
        const tax = Math.round(sub * TAX_RATE);
        const grand = sub + tax;
        return {
          sub,
          tax,
          grand,
          count: items.reduce((a, it) => a + it.qty, 0),
        };
      }

      function renderCart() {
        const list = el("cartList");
        const hint = el("cartHint");
        const t = totals();

        const cc = el("cartCount");
        if (cc) cc.textContent = t.count;
        const st = el("subTotal");
        if (st) st.textContent = rupiah(t.sub);
        const tx = el("tax");
        if (tx) tx.textContent = rupiah(t.tax);
        const gr = el("grand");
        if (gr) gr.textContent = rupiah(t.grand);

        const btnCheckout = el("btnCheckout");
        if (btnCheckout) btnCheckout.disabled = t.count === 0;

        if (!list || !hint) return;

        list.innerHTML = "";
        if (t.count === 0) {
          hint.textContent = "Belum ada item.";
          list.innerHTML = `<div class="line" style="grid-template-columns:1fr; text-align:center">
          <span>Tambahkan menu favoritmu ✨</span>
        </div>`;
          return;
        }
        hint.textContent = t.count + " item di keranjang.";

        cartItems().forEach((it) => {
          const line = document.createElement("div");
          line.className = "line";
          line.innerHTML = `
          <div style="display:flex; flex-direction:column; gap:2px">
            <b>${it.name}</b>
            <span>${rupiah(it.price)} • ${it.cat}</span>
          </div>
          <div class="qty">
            <button data-dec="${it.id}" title="Kurangi">−</button>
            <input value="${it.qty}" inputmode="numeric" data-qty="${it.id}" />
            <button data-inc="${it.id}" title="Tambah">+</button>
          </div>
        `;
          list.appendChild(line);
        });

        list
          .querySelectorAll("[data-dec]")
          .forEach(
            (b) =>
              (b.onclick = () => changeQty(b.getAttribute("data-dec"), -1)),
          );
        list
          .querySelectorAll("[data-inc]")
          .forEach(
            (b) =>
              (b.onclick = () => changeQty(b.getAttribute("data-inc"), +1)),
          );
        list.querySelectorAll("[data-qty]").forEach((inp) => {
          inp.onchange = () => {
            const id = inp.getAttribute("data-qty");
            const item = MENU.find((m) => m.id === id);
            const v = clampInt(inp.value, 1, item?.stock ?? 99);
            state.cart.set(id, v);
            renderAll();
          };
        });
      }

      function renderCheckout() {
        const t = totals();
        const ms = el("mSub");
        if (ms) ms.textContent = rupiah(t.sub);
        const mt = el("mTax");
        if (mt) mt.textContent = rupiah(t.tax);
        const mg = el("mGrand");
        if (mg) mg.textContent = rupiah(t.grand);

        const lines = el("orderLines");
        const items = cartItems();
        if (lines) {
          lines.innerHTML = items
            .map(
              (it) => `
          <div class="row" style="margin:8px 0">
            <span>${it.name} <span style="color:var(--muted)">× ${it.qty}</span></span>
            <b>${rupiah(it.price * it.qty)}</b>
          </div>
        `,
            )
            .join("");
        }

        computeChange();
      }

      function renderAll() {
        renderTabs();
        renderCards();
        renderCart();
      }

      // ====== Cart ops ======
      function addToCart(id) {
        const item = MENU.find((m) => m.id === id);
        if (!item) return;
        if (item.stock <= 0) return toast("Maaf, stok habis.");
        const curr = state.cart.get(id) || 0;
        if (curr + 1 > item.stock)
          return toast("Maksimal sesuai stok (" + item.stock + ").");
        state.cart.set(id, curr + 1);
        toast("Ditambahkan: " + item.name);
        renderAll();
      }
      function changeQty(id, delta) {
        const item = MENU.find((m) => m.id === id);
        const curr = state.cart.get(id) || 0;
        const next = curr + delta;
        if (next <= 0) {
          state.cart.delete(id);
          renderAll();
          return;
        }
        if (item && next > item.stock) {
          toast("Maksimal sesuai stok (" + item.stock + ").");
          return;
        }
        state.cart.set(id, next);
        renderAll();
      }

      // ====== Draft & History ======
      function saveDraft() {
        const obj = Object.fromEntries(state.cart.entries());
        localStorage.setItem(
          state.draftKey,
          JSON.stringify({ ts: Date.now(), cart: obj }),
        );
        toast("Draft tersimpan.");
      }
      function loadDraft() {
        try {
          const raw = localStorage.getItem(state.draftKey);
          if (!raw) return false;
          const data = JSON.parse(raw);
          state.cart = new Map(
            Object.entries(data.cart || {}).map(([k, v]) => [k, Number(v)]),
          );
          return true;
        } catch {
          return false;
        }
      }

      function pushHistory(order) {
        const raw = localStorage.getItem(state.historyKey);
        const arr = raw ? JSON.parse(raw) : [];
        arr.unshift(order);
        localStorage.setItem(
          state.historyKey,
          JSON.stringify(arr.slice(0, 30)),
        );
      }

      function showHistory() {
        const raw = localStorage.getItem(state.historyKey);
        const arr = raw ? JSON.parse(raw) : [];
        openModal("Riwayat Pesanan");

        const left = el("leftPanel");
        const right = el("rightPanel");
        if (!left || !right) return;

        left.innerHTML =
          `<h4>Riwayat Pesanan</h4>` +
          (arr.length
            ? ""
            : `<div class="note">Belum ada riwayat. Lakukan checkout dulu.</div>`);
        right.innerHTML = `
        <h4>Aksi</h4>
        <div class="note">Klik salah satu pesanan untuk melihat struk ringkas.</div>
        <div style="margin-top:12px; display:flex; gap:10px">
          <button class="btn danger" id="btnClearHistory" style="flex:1">Hapus Riwayat</button>
          <button class="btn secondary" id="btnBackCheckout" style="flex:1">Kembali</button>
        </div>
      `;

        const list = document.createElement("div");
        list.style.marginTop = "12px";
        list.style.display = "flex";
        list.style.flexDirection = "column";
        list.style.gap = "10px";

        arr.forEach((o) => {
          const box = document.createElement("div");
          box.className = "panel";
          box.style.cursor = "pointer";
          const dt = new Date(o.ts);
          box.innerHTML = `
          <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start">
            <div>
              <div style="font-weight:900">#${String(o.code).slice(-6)} • ${o.customer || "—"} • ${o.table || "—"}</div>
              <div class="note">${dt.toLocaleString("id-ID")} • ${o.method.toUpperCase()}</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:900">${rupiah(o.total)}</div>
              <div class="note">${o.items.reduce((a, x) => a + x.qty, 0)} item</div>
            </div>
          </div>
        `;
          box.onclick = () => {
            openModal("Struk Pesanan");
            showReceipt(o);
          };
          list.appendChild(box);
        });
        left.appendChild(list);

        setTimeout(() => {
          const ch = el("btnClearHistory");
          const back = el("btnBackCheckout");
          if (ch)
            ch.onclick = () => {
              localStorage.removeItem(state.historyKey);
              toast("Riwayat dihapus.");
              closeModal();
            };
          if (back)
            back.onclick = () => {
              closeModal();
              openCheckout();
            };
        }, 0);
      }

      // ====== Modal ======
      function openModal(title) {
        const mt = el("modalTitle");
        const ov = el("overlay");
        if (mt) mt.textContent = title;
        if (ov) {
          ov.classList.add("show");
          ov.setAttribute("aria-hidden", "false");
        }
      }
      function closeModal() {
        const ov = el("overlay");
        if (!ov) return;
        ov.classList.remove("show");
        ov.setAttribute("aria-hidden", "true");
      }

      function openCheckout() {
        const lp = el("leftPanel");
        const rp = el("rightPanel");
        if (!lp || !rp) return;

        // restore default checkout panels
        lp.innerHTML = `
        <h4>Rincian Pesanan</h4>
        <div id="orderLines"></div>
        <div style="margin-top:12px; padding-top:12px; border-top:1px dashed rgba(148,163,184,.22)">
          <div class="row"><span>Subtotal</span><b id="mSub">Rp 0</b></div>
          <div class="row"><span>Pajak & Service (10%)</span><b id="mTax">Rp 0</b></div>
          <div class="row"><span>Total</span><b id="mGrand">Rp 0</b></div>
        </div>
        <div class="field">
          <label for="notes">Catatan (opsional)</label>
          <textarea id="notes" placeholder="Contoh: tanpa es, level pedas 2, dll."></textarea>
        </div>
        <div class="note">*Disclaimer: Hanya untuk pengguna usia legal sesuai hukum setempat. Minum alkohol secara bertanggung jawab.</div>
      `;

        rp.innerHTML = `
        <h4>Pembayaran</h4>
        <div class="field"><label for="customer">Nama Pelanggan</label><input id="customer" placeholder="Nama" /></div>
        <div class="field"><label for="table">No. Meja / Takeaway</label><input id="table" placeholder="Contoh: Meja 7 / Takeaway" /></div>
        <div class="field">
          <label>Metode</label>
          <div class="payMethods">
            <label class="radio"><input type="radio" name="pay" value="cash" checked /> Cash</label>
            <label class="radio"><input type="radio" name="pay" value="transfer" /> Transfer</label>
          </div>
        </div>
        <div id="cashBox">
          <div class="field"><label for="paid">Uang Dibayar (Cash)</label><input id="paid" inputmode="numeric" placeholder="Contoh: 100000" /></div>
          <div class="row"><span>Kembalian</span><b id="change">Rp 0</b></div>
          <div class="note" style="margin-top:8px">Kembalian otomatis dihitung. Jika kurang, tombol Bayar akan terkunci.</div>
        </div>
        <div id="tfBox" style="display:none">
          <div class="panel" style="margin-top:10px">
            <h4 style="margin:0 0 8px">Instruksi Transfer</h4>
            <div class="note">Bank: <b>BCA</b><br/>No. Rek: <b>1234567890</b><br/>A/N: <b>Alchemy Bar & Cafe</b><br/>Catatan: tulis <b>Nama + No.Meja</b></div>
          </div>
          <div class="field" style="margin-top:10px"><label for="tfRef">Kode Referensi / ID Transaksi (opsional)</label><input id="tfRef" placeholder="Contoh: TRX-982311" /></div>
          <div class="note">Setelah transfer, klik Bayar untuk membuat struk. (Untuk produksi, biasanya verifikasi otomatis/manual diperlukan.)</div>
        </div>
        <div class="cta" style="margin-top:14px">
          <button class="btn secondary" id="btnPrint" title="Cetak struk">Cetak</button>
          <button class="btn" id="btnPay">Bayar & Buat Struk</button>
        </div>
        <div class="footerNote" id="payStatus"></div>
      `;

        // wire events after DOM inserted
        setTimeout(() => {
          document
            .querySelectorAll('input[name="pay"]')
            .forEach((r) => (r.onchange = onPayMethodChange));
          const paidEl = el("paid");
          if (paidEl) paidEl.addEventListener("input", computeChange);
          const payBtn = el("btnPay");
          if (payBtn) payBtn.onclick = pay;
          const prBtn = el("btnPrint");
          if (prBtn) prBtn.onclick = () => window.print();
        }, 0);

        openModal("Checkout");
        setTimeout(renderCheckout, 0);
      }

      function onPayMethodChange() {
        const method =
          document.querySelector('input[name="pay"]:checked')?.value || "cash";
        const cashBox = el("cashBox");
        const tfBox = el("tfBox");
        if (cashBox) cashBox.style.display = method === "cash" ? "" : "none";
        if (tfBox) tfBox.style.display = method === "transfer" ? "" : "none";
        computeChange();
      }

      function computeChange() {
        const t = totals();
        const method =
          document.querySelector('input[name="pay"]:checked')?.value || "cash";
        const btn = el("btnPay");
        const status = el("payStatus");
        const changeEl = el("change");

        if (method === "transfer") {
          // FIX: sebelumnya ada el('change')?.(null) yang memanggil elemen sebagai fungsi
          if (changeEl) changeEl.textContent = rupiah(0);
          if (btn) btn.disabled = t.grand <= 0;
          if (status)
            status.textContent =
              t.grand > 0 ? "Siap dibuatkan struk transfer." : "";
          return;
        }

        const paidRaw = (el("paid")?.value || "").replace(/[^0-9]/g, "");
        const paid = paidRaw ? Number(paidRaw) : 0;
        const ch = paid - t.grand;
        if (changeEl) changeEl.textContent = rupiah(Math.max(0, ch));
        if (btn) btn.disabled = t.grand <= 0 || paid < t.grand;
        if (status)
          status.textContent =
            paid < t.grand
              ? "Uang dibayar kurang."
              : paid
                ? "Uang cukup."
                : "Masukkan nominal cash.";
      }

      function showReceipt(order) {
        const left = el("leftPanel");
        const right = el("rightPanel");
        if (!left || !right) return;
        const dt = new Date(order.ts);

        left.innerHTML = `
        <h4>Struk</h4>
        <div class="panel" style="margin-top:10px">
          <div style="display:flex; justify-content:space-between; gap:12px">
            <div>
              <div style="font-weight:900">Alchemy Bar & Cafe</div>
              <div class="note">${dt.toLocaleString("id-ID")}</div>
              <div class="note">Kode: <b>#${String(order.code).slice(-6)}</b></div>
            </div>
            <div style="text-align:right">
              <div class="note">Metode</div>
              <div style="font-weight:900">${order.method.toUpperCase()}</div>
            </div>
          </div>
          <div style="margin-top:10px" class="note">Nama: <b>${order.customer || "—"}</b> • Meja: <b>${order.table || "—"}</b></div>
          <div style="margin-top:12px; padding-top:12px; border-top:1px dashed rgba(148,163,184,.22)">
            ${order.items
              .map(
                (it) => `
              <div class="row" style="margin:8px 0">
                <span>${it.name} <span style="color:var(--muted)">× ${it.qty}</span></span>
                <b>${rupiah(it.price * it.qty)}</b>
              </div>
            `,
              )
              .join("")}
          </div>
          <div style="margin-top:12px; padding-top:12px; border-top:1px dashed rgba(148,163,184,.22)">
            <div class="row"><span>Subtotal</span><b>${rupiah(order.subtotal)}</b></div>
            <div class="row"><span>Pajak & Service (10%)</span><b>${rupiah(order.tax)}</b></div>
            <div class="row"><span>Total</span><b>${rupiah(order.total)}</b></div>
            ${
              order.method === "cash"
                ? `<div class="row"><span>Dibayar</span><b>${rupiah(order.paid)}</b></div>
            <div class="row"><span>Kembalian</span><b>${rupiah(order.change)}</b></div>`
                : ""
            }
            ${order.method === "transfer" && order.tfRef ? `<div class="row"><span>Ref</span><b>${order.tfRef}</b></div>` : ""}
          </div>
          ${order.notes ? `<div style="margin-top:10px" class="note">Catatan: ${order.notes}</div>` : ""}
          <div style="margin-top:10px" class="note">Terima kasih! Minum bertanggung jawab 🙏</div>
        </div>
      `;

        right.innerHTML = `
        <h4>Aksi</h4>
        <div class="note">Anda bisa mencetak struk ini atau kembali ke menu.</div>
        <div style="margin-top:12px; display:flex; gap:10px">
          <button class="btn secondary" id="btnPrint2" style="flex:1">Cetak</button>
          <button class="btn" id="btnBack" style="flex:1">Kembali ke Menu</button>
        </div>
      `;

        setTimeout(() => {
          const p2 = el("btnPrint2");
          const bk = el("btnBack");
          if (p2) p2.onclick = () => window.print();
          if (bk) bk.onclick = () => closeModal();
        }, 0);
      }

      function pay() {
        const t = totals();
        if (t.count === 0) return;

        const method =
          document.querySelector('input[name="pay"]:checked')?.value || "cash";
        const customer = el("customer")?.value.trim() || "";
        const table = el("table")?.value.trim() || "";
        const notes = el("notes")?.value.trim() || "";

        if (!customer) {
          toast("Nama pelanggan wajib diisi.");
          el("customer")?.focus();
          return;
        }

        const code =
          Math.floor(100000 + Math.random() * 900000) +
          "-" +
          Date.now().toString(36).slice(-4);

        let paid = 0,
          change = 0,
          tfRef = "";
        if (method === "cash") {
          const paidRaw = (el("paid")?.value || "").replace(/[^0-9]/g, "");
          paid = paidRaw ? Number(paidRaw) : 0;
          if (paid < t.grand) {
            toast("Uang cash kurang.");
            return;
          }
          change = paid - t.grand;
        } else {
          tfRef = el("tfRef")?.value.trim() || "";
        }

        // Reduce stock (simulasi) & clear cart
        cartItems().forEach((it) => {
          const idx = MENU.findIndex((m) => m.id === it.id);
          if (idx >= 0) MENU[idx].stock = Math.max(0, MENU[idx].stock - it.qty);
        });

        const order = {
          ts: Date.now(),
          code,
          method,
          customer,
          table,
          notes,
          tfRef,
          subtotal: t.sub,
          tax: t.tax,
          total: t.grand,
          paid,
          change,
          items: cartItems().map((it) => ({
            id: it.id,
            name: it.name,
            price: it.price,
            qty: it.qty,
          })),
        };

        pushHistory(order);
        state.cart.clear();
        localStorage.removeItem(state.draftKey);
        toast("Pembayaran sukses. Struk dibuat.");
        renderAll();
        openModal("Struk Pesanan");
        showReceipt(order);
      }

      // ====== Surprise ======
      function surprise() {
        const list = MENU.filter(matches);
        if (list.length === 0) return;
        const picks = [...list].sort(() => Math.random() - 0.5).slice(0, 3);
        state.query = "";
        const q = el("q");
        if (q) q.value = "";
        renderAll();
        toast("Rekomendasi: " + picks.map((p) => p.name).join(", "));
      }

      // ====== Self Tests (minimal, tidak mengganggu UI) ======
      function runSelfTests() {
        try {
          console.assert(
            typeof el === "function",
            "Helper el() harus berupa function",
          );
          // Pastikan computeChange() tidak melempar error ketika mode transfer
          const transferRadio = document.querySelector(
            'input[name="pay"][value="transfer"]',
          );
          if (transferRadio) {
            transferRadio.checked = true;
            computeChange();
            console.assert(true, "computeChange() transfer mode OK");
            // restore cash
            const cashRadio = document.querySelector(
              'input[name="pay"][value="cash"]',
            );
            if (cashRadio) cashRadio.checked = true;
            computeChange();
          }
        } catch (e) {
          console.error("Self test gagal:", e);
        }
      }

      // ====== Wire events ======
      function init() {
        if (loadDraft()) toast("Draft keranjang dimuat.");

        renderAll();

        el("q")?.addEventListener("input", (e) => {
          state.query = e.target.value;
          renderAll();
        });

        window.addEventListener("keydown", (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "k") {
            e.preventDefault();
            el("q")?.focus();
          }
          if (e.key === "Escape") closeModal();
        });

        el("btnClear") &&
          (el("btnClear").onclick = () => {
            state.cart.clear();
            toast("Keranjang dikosongkan.");
            renderAll();
          });
        el("btnSave") && (el("btnSave").onclick = saveDraft);
        el("btnCheckout") && (el("btnCheckout").onclick = openCheckout);
        el("btnOpenCheckout") &&
          (el("btnOpenCheckout").onclick = () => {
            totals().count ? openCheckout() : toast("Keranjang masih kosong.");
          });
        el("btnClose") && (el("btnClose").onclick = closeModal);
        el("overlay")?.addEventListener("click", (e) => {
          if (e.target === el("overlay")) closeModal();
        });
        el("btnSurprise") && (el("btnSurprise").onclick = surprise);
        el("btnHistory") && (el("btnHistory").onclick = showHistory);

        el("btnPrint") && (el("btnPrint").onclick = () => window.print());

        document
          .querySelectorAll('input[name="pay"]')
          .forEach((r) => (r.onchange = onPayMethodChange));
        el("paid")?.addEventListener("input", computeChange);
        el("btnPay") && (el("btnPay").onclick = pay);

        runSelfTests();
      }

      init();
    </script>
  </body>
</html>
